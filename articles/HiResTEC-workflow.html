<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>HiResTEC-workflow • HiResTEC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="HiResTEC-workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">HiResTEC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.63.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/HiResTEC-workflow.html">HiResTEC-workflow</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/janlisec/HiResTEC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>HiResTEC-workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/janlisec/HiResTEC/blob/main/vignettes/HiResTEC-workflow.Rmd" class="external-link"><code>vignettes/HiResTEC-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>HiResTEC-workflow.Rmd</code></div>
    </div>

    
    
<p><code>HiResTEC</code> aims to find and validate measurement signals
in mass spectrometry data that indicate the incorporation of a tracer
molecule,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">^{13}C</annotation></semantics></math>
which is a common approach in metabolic flux analysis.</p>
<p>To this end, at least 3 measurement files containing non-labeled
samples and 3 measurement files containing labeled samples need to be
available. This vignette will demonstrate the general workflow on a set
of 18 samples from two groups and three time points.</p>
<p>Let’s start with loading the example data set provided with the
package and setting up a sample table describing these files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw</span> <span class="op">&lt;-</span> <span class="fu">HiResTEC</span><span class="fu">::</span><span class="va"><a href="../reference/HiResTEC-data.html">raw</a></span></span>
<span><span class="va">sam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">"gr"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, </span>
<span>  <span class="st">"tp"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>, each<span class="op">=</span><span class="fl">6</span><span class="op">)</span>, </span>
<span>  <span class="st">"rep"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sam</span><span class="op">[</span>,<span class="st">"ids"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">sam</span>, <span class="fl">1</span>, <span class="va">paste0</span>, collapse<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sam</span><span class="op">)</span></span>
<span><span class="co">#&gt;   gr tp rep   ids</span></span>
<span><span class="co">#&gt; 1  A  0   1 A_0_1</span></span>
<span><span class="co">#&gt; 2  A  0   2 A_0_2</span></span>
<span><span class="co">#&gt; 3  A  0   3 A_0_3</span></span>
<span><span class="co">#&gt; 4  B  0   1 B_0_1</span></span>
<span><span class="co">#&gt; 5  B  0   2 B_0_2</span></span>
<span><span class="co">#&gt; 6  B  0   3 B_0_3</span></span></code></pre></div>
<p>It contains 18 measurements stored in a list as
<code>xcmsRawLike</code> objects. The samples belong to two groups
(annotated as <strong>A</strong> and <strong>B</strong> in column
<code>gr</code>) and were taken at three different time points
(annotated as <strong>0</strong>, <strong>1</strong> and
<strong>2</strong> in column <code>tp</code>). We can plot the base peak
chromatograms (BPCs) for these files to observe that they contain only a
small retention time window (appr. 10s) and a limited mass range.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">raw</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "xcmsRawLike"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "CorrectOverloadedPeaks"</span></span>
<span><span class="va">raw</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">mzrange</span></span>
<span><span class="co">#&gt; [1] 520.1361 619.6102</span></span>
<span><span class="va">bpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">raw</span>, <span class="fu">HiResTEC</span><span class="fu">::</span><span class="va"><a href="../reference/getMultipleBPC.html">getMultipleBPC</a></span><span class="op">)</span></span>
<span><span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/plotBPC.html">plotBPC</a></span><span class="op">(</span><span class="va">bpc</span>, type <span class="op">=</span> <span class="st">"bpc"</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">6</span><span class="op">)</span>, ids <span class="op">=</span> <span class="va">sam</span><span class="op">[</span>,<span class="st">"ids"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="HiResTEC-workflow_files/figure-html/show_raw_bpc-1.png" width="98%"></p>
<p>There appears to be a peak at rt = 1026.5s in all files. Let’s
deconvolute the ion intensities at this rt and plot the spectrum.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="fl">1026.5</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/DeconvoluteSpectrum.html">DeconvoluteSpectrum</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">raw</span>, rt <span class="op">=</span> <span class="va">rt</span><span class="op">)</span></span>
<span><span class="fu">InterpretMSSpectrum</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/InterpretMSSpectrum/man/PlotSpec.html" class="external-link">PlotSpec</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span></code></pre></div>
<p><img src="HiResTEC-workflow_files/figure-html/show_spectrum-1.png" width="700"></p>
<p>The base peak is observed at m/z = 556.263. We can extract the mass
isotopomer distribution (MID) of m/z 556.263 and its isotopes for all
files. For better visibility we omit plotting the intermediate time
point <strong>1</strong> and group <strong>B</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fl">556.263</span></span>
<span><span class="va">mz_dev</span> <span class="op">&lt;-</span> <span class="fl">0.4</span></span>
<span><span class="va">bpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">raw</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/getMultipleBPC.html">getMultipleBPC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, mz <span class="op">=</span> <span class="va">mz</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">*</span><span class="fl">1.003355</span>, mz_dev <span class="op">=</span> <span class="va">mz_dev</span><span class="op">)</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">flt</span> <span class="op">&lt;-</span> <span class="va">sam</span><span class="op">[</span>,<span class="st">"tp"</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">sam</span><span class="op">[</span>,<span class="st">"gr"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"A"</span></span>
<span><span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/plotBPC.html">plotBPC</a></span><span class="op">(</span><span class="va">bpc</span><span class="op">[</span><span class="va">flt</span><span class="op">]</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>, ids <span class="op">=</span> <span class="va">sam</span><span class="op">[</span><span class="va">flt</span>,<span class="st">"ids"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="HiResTEC-workflow_files/figure-html/show_mid-1.png" width="98%"></p>
<p>The figure shows that the MID changes systematically between
replicate samples of time points 0 and 2. To test hypotheses of m/z
pairs indicating label incorporation <code>HiResTEC</code> needs a peak
list. You can use any peak picking algorithm to get such a peak list.
<code>HiResTEC</code> accepts an <code>xcmsSet</code> result as input or
alternatively a numeric matrix containing <code>mz</code> and
<code>rt</code> information in the first two columns followed by peak
intensities of all samples.</p>
<p>We can prepare such a peak list for the example data using the maxima
from the BPCs we just extracted.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bpc</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"maxBPC"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sam</span><span class="op">[</span>,<span class="st">"ids"</span><span class="op">]</span></span>
<span><span class="va">xg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"mz"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span><span class="op">)</span>, <span class="st">"rt"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rt</span>,<span class="fl">7</span><span class="op">)</span>, <span class="va">int</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">xg</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;         mz     rt  A_0_1   A_0_2   A_0_3   B_0_1   B_0_2   B_0_3</span></span>
<span><span class="co">#&gt; 1 556.2630 1026.5 885279 3312706 1177134 3173920 1587268 1779726</span></span>
<span><span class="co">#&gt; 2 557.2664 1026.5 410974 1651166  542420 1539848  749420  881862</span></span>
<span><span class="co">#&gt; 3 558.2697 1026.5 196540  831255  253851  762537  368239  440807</span></span>
<span><span class="co">#&gt; 4 559.2731 1026.5  56425  246355   73354  214614  103306  124894</span></span>
<span><span class="co">#&gt; 5 560.2764 1026.5  16214   58556   18540   51556   24568   31298</span></span>
<span><span class="co">#&gt; 6 561.2798 1026.5   3119    8376    3447    7303    5148    5453</span></span>
<span><span class="co">#&gt; 7 562.2831 1026.5    767    1035     886    1134     798    1007</span></span></code></pre></div>
<p>Finally, we can apply the two main functions of
<code>HiResTEC</code>. First, we evaluate our peak list to identify
interesting m/z pairs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preCL</span> <span class="op">&lt;-</span> <span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/EvaluatePairsFromXCMSSet.html">EvaluatePairsFromXCMSSet</a></span><span class="op">(</span>xg <span class="op">=</span> <span class="va">xg</span>, tp <span class="op">=</span> <span class="va">sam</span><span class="op">$</span><span class="va">tp</span>, gr <span class="op">=</span> <span class="va">sam</span><span class="op">$</span><span class="va">gr</span>, dmz <span class="op">=</span> <span class="fl">0.04</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">preCL</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">preCL</span><span class="op">[</span>,<span class="st">"P"</span><span class="op">]</span><span class="op">)</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         mz1      mz2            P    dR dRT</span></span>
<span><span class="co">#&gt; 17 559.2731 561.2798 5.474917e-13 87.25   0</span></span>
<span><span class="co">#&gt; 20 560.2764 562.2831 3.685086e-10 75.74   0</span></span>
<span><span class="co">#&gt; 18 559.2731 562.2831 7.766381e-10 80.84   0</span></span>
<span><span class="co">#&gt; 14 558.2697 561.2798 2.303710e-08 83.10   0</span></span>
<span><span class="co">#&gt; 19 560.2764 561.2798 2.935232e-08 74.93   0</span></span>
<span><span class="co">#&gt; 10 557.2664 561.2798 5.373940e-07 75.64   0</span></span></code></pre></div>
<p>The function finds all relevant pairs within the specified parameters
(allowed mass difference, allowed rt window, see help file of
<em>EvaluatePairsFromXCMSSet()</em> for details) and tests each pair
using an ANOVA model based on the group and time point information of
each sample.</p>
<p>Above, we sorted the output according to the P-value (column
<code>P</code>). We could also have sorted according to column
<code>dR</code> which gives the change in the intensity ratio between
the first and the last time point specified. However, the lowest P-value
is obtained for an m/z pair {559, 561} within the MID of our peak. The
correct solution would be m/z pair {556, 561}.</p>
<p>The task to pick the best candidate, to apply rigorous quality
control and avoid redundancy in the final result is achieved by the
second step of the evaluation, where we cross check the preliminary
candidate list <strong>preCL</strong> against the raw data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finCL</span> <span class="op">&lt;-</span> <span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/EvaluateCandidateListAgainstRawData.html">EvaluateCandidateListAgainstRawData</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">preCL</span>, tp <span class="op">=</span> <span class="va">sam</span><span class="op">$</span><span class="va">tp</span>, gr <span class="op">=</span> <span class="va">sam</span><span class="op">$</span><span class="va">gr</span>, dat <span class="op">=</span> <span class="va">raw</span>, dmz <span class="op">=</span> <span class="fl">0.04</span>, rolp <span class="op">=</span> <span class="st">"all"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><em>EvaluateCandidateListAgainstRawData()</em> will result in a
l<em>oooo</em>ng list in a real non-targeted experiment. However, as we
only tested the MID of a single peak and decided to remove redundancy
(parameter <strong>rolp</strong>), only a single candidate remains.</p>
<p>This candidate can be exported to Excel, and can be checked by
generating quality control plots in a PDF using function
<em>GenerateQCPlots()</em>. Four QC plots are generated per candidate.
First, the enrichment in all samples is depicted.</p>
<p><img src="HiResTEC-workflow_files/figure-html/QCplot1-1.png" width="98%"></p>
<p>The enrichment is estimated based on the assumption that
<strong>n</strong>, the difference between mz1 and mz2 or the number of
incorporated tracer atoms, is equivalent to the total number of tracer
atoms in the molecule. This assumption is generally incorrect, but the
obtained values are a good approximation for the amount of labeling.</p>
<p>Time points are color coded and different plotting symbols are used
for groups. Individual samples can be identified in the left subplot due
to their number from the sample list. The annotation ‘dE’ in the left
subplot provides the maximum difference in enrichment between samples.
The P-values annotated in the right subplot are obtained from the ANOVA
result. In short, if ‘dE’ is large and ‘P_tp’ is small, it is worth
looking at the other QC plots.</p>
<p>The second QC plot provides the BPCs as shown before. Let’s limit
this figure this time to the first replicate of each time point and
group.</p>
<p><img src="HiResTEC-workflow_files/figure-html/QCplot2-1.png" width="98%"></p>
<p>Numerous things can be checked in this plot. Obviously the peak shape
of all masses should be nice and co-located.
<strong><em>Note!</em></strong> that the intensities are depicted
log10-transformed to enhance small signals. The spectra on the right
hand subplots are not log10-transformed to emphasize differences between
time points. Each spectrum depicts the intensities from the scan in the
left subplot indicated by the grey line, usually the peak center. In the
spectra, one should confirm that the ratio of mz1 (black) and mz2
(purple) is really changing. This sounds trivial, but is sometimes not
the case if errors inpeak picking or deconvolution occurred.</p>
<p>Also, the small numbers at the top of each mass intensity are very
informative. The indicate the difference of the measured mass from the
theoretical mass in mDa. The theoretical mass of a M+5 isotope in a
tracer experiment using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">^{13}C</annotation></semantics></math>
would be calculated by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>+</mo><mn>5</mn><mo>×</mo><mn>1.0034</mn></mrow><annotation encoding="application/x-tex">M + 5 \times 1.0034</annotation></semantics></math>
(because 1.0034 is the difference between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mn>12</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">^{12}C</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi></mi><mn>13</mn></msup><mi>C</mi></mrow><annotation encoding="application/x-tex">^{13}C</annotation></semantics></math>).
In GC-APCI-MS (which this example is coming from), analytes are
derivatized before analysis, often using TMS groups (Tri-Methyl-Silyl).
TMS contains silicon and silicon isotopes have a different mass
difference than carbon. This leads to the effect of negative mass
deviations in the above spectra for higher isotopes in non labeled
samples, as here silicon determines the mass and not carbon. In labeled
samples (tp=1 and tp=2), carbon starts to determine the mass deviation
instead of silicon.</p>
<p>In consequence, observing a strong negative mass deviation in tp=0
samples for mz2 (purple) and a minor mass deviation in labeled samples
is a strong indicator for successful tracer incorporation.</p>
<p>The third and fourth QC plots provide spectra deconvoluted from raw
data. These should be checked to confirm if the candidate m/z pair is
representative for the compound (is it the base peak? is it the likely
M+H?).</p>
<p><img src="HiResTEC-workflow_files/figure-html/QCplot3-1.png" width="98%"></p>
<p>For those candidates looking promising, one can use the
<code>InterpretMSSpectrum</code> package to identify likely sum formulas
for each compound, and use the <code>CorMID</code> package to correct
the intensities obtained by <code>HiResTEC</code> for natural
abundance.</p>
<p>To demonstrate this shortly, <code>InterpretMSSpectrum</code>
suggests
C<sub>22</sub>H<sub>46</sub>N<sub>5</sub>O<sub>4</sub>Si<sub>4</sub> as
a possible sum formula.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fml</span> <span class="op">&lt;-</span> <span class="st">"C22H46N5O4Si4"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fml</span>, <span class="st">"nbio"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># re-extract the BPCs including [M+]</span></span>
<span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">finCL</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mz1</span></span>
<span><span class="va">rt</span> <span class="op">&lt;-</span> <span class="va">finCL</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">rt</span></span>
<span><span class="va">bpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">raw</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu">HiResTEC</span><span class="fu">::</span><span class="fu"><a href="../reference/getMultipleBPC.html">getMultipleBPC</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, mz <span class="op">=</span> <span class="va">mz</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">*</span><span class="fl">1.003355</span>, mz_dev <span class="op">=</span> <span class="fl">0.04</span>, rt <span class="op">=</span> <span class="va">rt</span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BPCs show about 2.5% [M+] intensity, define r accordingly</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.975</span>, <span class="fl">0.025</span><span class="op">)</span>, nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M+H"</span>, <span class="st">"M+"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">bpc</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"maxBPC"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"M"</span>,<span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">int</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">sam</span><span class="op">$</span><span class="va">ids</span></span>
<span><span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">int</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> </span>
<span>  <span class="fu">CorMID</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/CorMID/man/CorMID.html" class="external-link">CorMID</a></span><span class="op">(</span>int <span class="op">=</span> <span class="va">x</span>, fml <span class="op">=</span> <span class="va">fml</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show mean group corrected MID</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mid</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">sam</span><span class="op">[</span>,<span class="st">"gr"</span><span class="op">]</span>, <span class="va">sam</span><span class="op">[</span>,<span class="st">"tp"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">2</span>,<span class="va">mean</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;     A.0  B.0  A.1  B.1  A.2  B.2</span></span>
<span><span class="co">#&gt; M0 99.2 99.2 96.4 97.1 24.7 55.7</span></span>
<span><span class="co">#&gt; M1  0.8  0.8  0.0  0.0  0.0  0.0</span></span>
<span><span class="co">#&gt; M2  0.0  0.0  0.0  0.0  0.8  0.0</span></span>
<span><span class="co">#&gt; M3  0.0  0.0  0.0  0.0  1.0  0.3</span></span>
<span><span class="co">#&gt; M4  0.0  0.0  0.0  0.0  3.6  1.8</span></span>
<span><span class="co">#&gt; M5  0.0  0.0  3.6  2.9 69.8 42.2</span></span></code></pre></div>
<p>As can be seen from the mean corrected MID per group, the estimate of
enrichment shown in the QC plots above (70% and 40% at tp 2 for group A
and B respectively) is pretty close to the results obtained by
<code>CorMID</code>.</p>
<p>Have fun, using <code>HiResTEC</code> and, in the likely event that
something does not work as expected, let me know.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jan Lisec, Friederike Hoffmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
